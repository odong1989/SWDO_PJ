<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="net.softsociety.binder.dao.DocumentMapper">

<!--
	select bnd_document.document_no,bnd_document.document_content
	from bnd_document
	where bnd_document.member_id = 'jsh4646';
 -->
 	<select id="selectDocuments" parameterType="int" resultType="hashmap">
	 	select
		    bnd_document.document_no document_no
		    , bnd_document.document_content document_content
		    , to_char(bnd_document.document_regdate, 'yyyy-mm-dd') document_regdate
		    , bnd_document.document_destination document_destination
		    , bnd_photo.photo_savedfile photo_savedfile
		from
		    bnd_document, bnd_photo
		where
		    bnd_document.group_no = #{group_no}
		and
		    bnd_document.document_no = bnd_photo.document_no
	</select> 

 	<select id="selectCaution" parameterType="int" resultType="document">
	 	select
		    bnd_document.document_content
		from
		    bnd_document
		where
		    bnd_document.group_no = #{group_no}
		and
		    bnd_document.document_notice = 1
	</select> 
	
	<select id="selectDocumentsForCalendar" parameterType="int" resultType="hashmap">
	 	select
		    bnd_document.document_no 								document_no
			, bnd_document.member_id								member_id
		    , bnd_document.document_content 						document_content
		    , to_char(bnd_document.document_regdate, 'yyyy-mm-dd')  document_regdate
		    , to_char(bnd_document.document_finalday, 'yyyy-mm-dd') document_finalday
		    , bnd_document.document_destination						document_destination
			, bnd_document.document_notice							document_notice
		    , bnd_photo.photo_savedfile 							photo_savedfile
		from
		    bnd_document, bnd_photo
		where
		    bnd_document.group_no = #{group_no}
		and
		    bnd_document.document_no = bnd_photo.document_no
	</select> 
	
	<insert id="insertCaution" parameterType="document">
	insert into
	bnd_document(
		group_no
		,document_no
		,member_id
		,document_content
		,document_notice
		,document_destination
		) values
		(
		#{group_no}
		,bnd_document_no_seq.nextval
		,#{member_id}
		,#{document_content}
		,1
		,#{document_destination}
		)
	</insert>
	
	<delete id="deleteCaution" parameterType="int">
		delete from
		bnd_document
		where 
		bnd_document.group_no = #{group_no}
		and
		bnd_document.document_notice = 1
	</delete>
</mapper>
